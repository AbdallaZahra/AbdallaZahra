<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Egypt Threads — Clothing Store (Responsive Demo)</title>
    <meta
      name="description"
      content="Urban Threads demo — responsive clothing store with quick view, cart drawer, mobile hamburger and filters."
    />
    <style>
      /* --- Your original styles preserved --- */
      :root {
        --bg: #0b0f12;
        --card: #ffffff;
        --muted: #9aa4a6;
        --accent: #0f1720;
        --accent-2: #0ff;
        --gold: #ffb84d;
        --glass: rgba(255, 255, 255, 0.03);
        --shadow: 0 15px 40px rgba(2, 6, 23, 0.5);
        --radius: 12px;
        --max-w: 1200px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: radial-gradient(
            1200px 600px at 8% 12%,
            rgba(0, 255, 255, 0.01),
            transparent 6%
          ),
          var(--bg);
        color: #0f1720;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        line-height: 1.4;
      }

      /* ===== layout container ===== */
      .container {
        max-width: var(--max-w);
        margin: 0 auto;
        padding: 1.25rem;
      }

      /* ===== header ===== */
      .site-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        padding: 0.85rem 1.25rem;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.02)
        );
        position: sticky;
        top: 0;
        z-index: 80;
        backdrop-filter: blur(6px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      }

      .brand {
        display: flex;
        gap: 0.9rem;
        align-items: center;
      }

      .logo {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        background: linear-gradient(135deg, #0f1720, #2b2b2b);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent-2);
        font-weight: 800;
        font-family: "Orbitron", sans-serif;
        box-shadow: 0 6px 18px rgba(0, 255, 255, 0.04);
      }

      .brand h1 {
        font-size: 1.05rem;
        margin: 0;
        color: #e6f8f9;
      }

      .brand .tag {
        font-size: 0.8rem;
        color: var(--muted);
      }

      nav.header-right {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .search {
        position: relative;
      }

      .search input {
        border-radius: 999px;
        padding: 0.5rem 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.03);
        width: 220px;
        background: var(--glass);
        color: #fff;
      }

      .chips {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .chip {
        background: transparent;
        color: #cfeff0;
        padding: 0.4rem 0.65rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        cursor: pointer;
        font-weight: 700;
        font-size: 0.85rem;
      }

      .chip.active {
        background: linear-gradient(
          90deg,
          var(--accent-2),
          rgba(191, 255, 255, 0.6)
        );
        color: #022;
        transform: scale(1.03);
      }

      .cart-btn {
        background: linear-gradient(180deg, #fff, #f6f6f6);
        padding: 0.45rem 0.75rem;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-weight: 700;
        color: #111;
      }

      /* hamburger for mobile - hidden by default */
      .hamburger {
        display: none;
        width: 40px;
        height: 40px;
        border-radius: 9px;
        border: none;
        cursor: pointer;
        background: linear-gradient(180deg, #0f1720, #1a1a1a);
        color: #fff;
        align-items: center;
        justify-content: center;
      }

      .hamburger .bar {
        justify-content: center;
        display: block;
        width: 18px;
        height: 2px;
        background: #cfeff0;
        margin: 3px 0;
        border-radius: 2px;
        transition: all 0.25s;
      }

      /* ===== hero area ===== */
      .hero {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 1.5rem;
        align-items: start;
        margin-top: 1.25rem;
        padding: 0 1.25rem;
      }

      .hero-card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.02)
        );
        padding: 1.75rem;
        border-radius: 12px;
        box-shadow: var(--shadow);
        color: #fff;
      }

      .kicker {
        color: var(--accent-2);
        font-weight: 800;
        letter-spacing: 1px;
        font-size: 0.8rem;
      }

      .hero-card h2 {
        font-size: 1.9rem;
        margin: 8px 0;
        color: #ffffff;
      }

      .hero-card p {
        color: #d7eef0;
        margin-bottom: 1rem;
      }

      .hero-cta {
        display: flex;
        gap: 0.6rem;
        align-items: center;
      }

      .btn-primary {
        background: linear-gradient(90deg, #111, #222);
        color: var(--accent-2);
        padding: 0.6rem 1rem;
        border-radius: 999px;
        border: none;
        font-weight: 800;
      }

      .btn-ghost {
        background: transparent;
        color: #fff;
        padding: 0.5rem 0.9rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      aside.promo {
        background: linear-gradient(180deg, #111, rgba(255, 255, 255, 0.02));
        border-radius: 12px;
        padding: 1rem;
        color: #fff;
        text-align: center;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      }

      aside.promo img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 8px;
        margin-top: 0.6rem;
      }

      /* controls & chips */
      .controls {
        display: flex;
        gap: 1rem;
        align-items: center;
        padding: 1rem 1.25rem;
      }

      .controls .chips {
        margin-left: 0;
      }

      /* ===== product grid ===== */
      .grid {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: stretch;
        padding: 0 1.25rem 2rem 1.25rem;
      }

      .card {
        background: var(--card);
        border-radius: 12px;
        overflow: hidden;
        flex: 1 1 calc(33.333% - 0.66rem);
        min-width: 240px;
        box-shadow: 0 12px 30px rgba(2, 6, 23, 0.06);
        transition: transform 0.28s, box-shadow 0.28s;
        display: flex;
        flex-direction: column;
      }

      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 22px 50px rgba(2, 6, 23, 0.12);
      }

      .card-visual {
        position: relative;
        height: 100%;
        background: #f8f8f8;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .card-visual img {
        width: 100%;
        height: 50vh;
        object-fit: cover;
        display: block;
      }

      .badge {
        position: absolute;
        left: 12px;
        top: 12px;
        background: var(--gold);
        color: #111;
        padding: 0.35rem 0.6rem;
        border-radius: 8px;
        font-weight: 800;
      }

      .card-body {
        padding: 0.9rem 1rem 1.2rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        flex: 1;
      }

      .title {
        font-weight: 800;
        color: var(--accent);
      }

      .meta {
        color: var(--muted);
        font-size: 0.92rem;
      }

      .price-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
      }

      .price {
        font-weight: 900;
        color: var(--accent);
      }

      .action-row {
        display: flex;
        gap: 0.5rem;
      }

      .btn-small {
        padding: 0.45rem 0.7rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 800;
      }

      .btn-view {
        background: transparent;
        color: var(--accent);
        border: 1px solid rgba(0, 0, 0, 0.06);
      }

      .btn-add {
        background: var(--accent);
        color: var(--accent-2);
      }

      /* ===== modal quick view ===== */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 120;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.6),
          rgba(0, 0, 0, 0.85)
        );
        padding: 2rem;
      }

      .modal.show {
        display: flex;
      }

      .modal-card {
        width: 100%;
        max-width: 980px;
        height: 80vh;
        background: var(--card);
        border-radius: 16px;
        overflow: auto;
        display: grid;
        grid-template-columns: 1fr 340px;
        gap: 1rem;
        padding: 1rem;
        box-shadow: 0 20px 60px rgba(2, 6, 23, 0.4);
      }

      .modal-left img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
      }

      .modal-right {
        padding: 0.5rem 0.8rem;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }

      /* ===== cart drawer ===== */
      .cart-drawer {
        position: fixed;
        right: 0;
        top: 0;
        height: 100vh;
        width: 400px;
        max-width: 92%;
        background: linear-gradient(180deg, #fff, #f6f6f6);
        transform: translateX(110%);
        transition: transform 0.36s;
        z-index: 130;
        display: flex;
        flex-direction: column;
        box-shadow: -30px 0 60px rgba(2, 6, 23, 0.25);
      }

      .cart-drawer.open {
        transform: translateX(0);
      }

      .cart-head {
        padding: 1rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        font-weight: 900;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .cart-items {
        padding: 1rem;
        overflow: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.9rem;
      }

      .cart-item {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .cart-item img {
        width: 64px;
        height: 64px;
        object-fit: cover;
        border-radius: 8px;
      }

      .cart-foot {
        padding: 1rem;
        border-top: 1px solid rgba(0, 0, 0, 0.06);
      }

      /* ===== footer ===== */
      footer.site-footer {
        background: #071018;
        color: #dfeff0;
        padding: 2rem 1.25rem;
        text-align: center;
        margin-top: 2rem;
      }

      footer .links {
        margin-top: 0.8rem;
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      footer a {
        color: #cfeff0;
        text-decoration: none;
        opacity: 0.9;
      }

      /* ===== responsive breakpoints ===== */
      @media (max-width: 1000px) {
        .hero {
          grid-template-columns: 1fr;
        }
        .card {
          flex: 1 1 calc(50% - 0.5rem);
        }
        .card-visual {
          min-height: 220px;
        }
        .modal-card {
          grid-template-columns: 1fr;
          height: 78vh;
        }
        .cart-drawer {
          width: 360px;
        }
      }

      @media (max-width: 700px) {
        .site-header {
          padding: 0.6rem 0.85rem;
        }
        .logo {
          width: 40px;
          height: 40px;
        }
        .search input {
          width: 140px;
        }
        .header-right {
          display: none;
        }
        /* hide desktop controls */
        .hamburger {
          display: inline-block;
        }
        /* show mobile control */
        .card {
          flex: 1 1 100%;
        }
        .card-visual {
          min-height: 160px;
        }
        .cart-drawer {
          width: 100%;
        }
        nav.header-right {
          display: none;
        }
      }

      /* mobile nav panel (slides in) */
      .mobile-nav {
        position: fixed;
        right: -100%;
        top: 0;
        height: 100vh;
        width: 280px;
        max-width: 92%;
        background: #071019;
        color: #fff;
        z-index: 140;
        padding: 1rem;
        transition: right 0.28s cubic-bezier(0.2, 0.9, 0.2, 1);
        box-shadow: -20px 0 40px rgba(0, 0, 0, 0.6);
      }

      .mobile-nav.open {
        right: 0;
      }

      .mobile-nav .close {
        float: right;
        background: none;
        border: none;
        color: #fff;
        font-size: 1.2rem;
        cursor: pointer;
      }

      .mobile-nav .section {
        margin-top: 1rem;
      }

      .mobile-nav input {
        width: 100%;
        padding: 0.6rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        background: transparent;
        color: #fff;
      }

      /* small visuals */
      .small {
        font-size: 0.85rem;
        color: var(--muted);
      }

      .sr-only {
        position: absolute;
        left: -9999px;
      }
      #products:has(.product-card:only-child) {
        display: flex;
        justify-content: center;
      }

      #products:has(.product-card:only-child) .product-card {
        max-width: 400px; /* or whatever width keeps image sharp */
        flex: none; /* stop it from stretching */
      }

      /* rest of your CSS unchanged... */
    </style>
  </head>
  <body>
    <!-- header -->
    <header class="site-header">
      <div class="brand">
        <div class="logo">ET</div>
        <div>
          <h1>Egypt Threads</h1>
          <div class="small">Street classics — modern fit</div>
        </div>
      </div>

      <!-- desktop controls -->
      <nav class="header-right">
        <div class="search">
          <input
            id="searchInput"
            placeholder="Search products..."
            aria-label="Search products"
          />
        </div>

        <div class="chips" id="desktopChips" role="list">
          <button class="chip active" data-cat="all" role="listitem">
            All
          </button>
          <button class="chip" data-cat="hoodies" role="listitem">
            Hoodies
          </button>
          <button class="chip" data-cat="street" role="listitem">Street</button>
          <button class="chip" data-cat="trousers" role="listitem">
            Trousers
          </button>
          <button class="chip" data-cat="bags" role="listitem">Bags</button>
        </div>

        <button class="cart-btn" id="cartBtn" aria-controls="cartDrawer">
          Cart (<span id="cartCount">0</span>)
        </button>
      </nav>

      <!-- hamburger for mobile -->
      <button class="hamburger" id="hamburger" aria-label="Open menu">
        <span class="bar"></span><span class="bar"></span
        ><span class="bar"></span>
      </button>
    </header>
    <!-- mobile nav -->
    <nav id="mobileNav" class="mobile-nav" aria-hidden="true">
      <button class="close" id="mobileClose" aria-label="Close menu">✕</button>

      <div class="section">
        <input
          id="mobileSearch"
          placeholder="Search products..."
          aria-label="Search products mobile"
        />
      </div>

      <div class="section">
        <div class="small">Categories</div>
        <div
          style="
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.6rem;
          "
        >
          <button class="chip" data-cat="all">All</button>
          <button class="chip" data-cat="hoodies">hoodies</button>
          <button class="chip" data-cat="street">Street</button>
          <button class="chip" data-cat="trousers">trousers</button>
          <button class="chip" data-cat="bags">Bags</button>
        </div>
      </div>

      <div style="margin-top: auto">
        <button id="mobileCartBtn" class="cart-btn" style="width: 100%">
          Cart (<span id="cartCountMobile">0</span>)
        </button>
      </div>
    </nav>

    <main class="container" id="main">
      <!-- hero -->
      <section class="hero" aria-label="Featured">
        <div class="hero-card">
          <div class="kicker">New in — Limited Run</div>
          <h2>Egypt Threads x Street Wear</h2>
          <p>
            Seasonal streetwear designed with bold, minimal aesthetics. Crafted
            from premium materials for comfort and durability — stylish,
            versatile, and made to last.
          </p>

          <div class="hero-cta">
            <button class="btn-primary" id="shopNow">Shop Men</button>
            <button class="btn-ghost" id="viewCollection">Lookbook</button>
          </div>

          <div style="height: 0.8rem"></div>

          <div class="promo">
            <small>Free shipping on orders over $80 • 30-day returns</small>
          </div>
        </div>

        <aside class="promo" aria-hidden="false">
          <h3 style="margin: 0 0 0.6rem 0">Featured Drop</h3>
          <img
            src="https://images.unsplash.com/photo-1512374382149-233c42b6a83b?q=80&w=735&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="preview"
            id="sideFeatured"
            style="
              width: 100%;
              height: 220px;
              object-fit: cover;
              border-radius: 8px;
            "
          />
          <p class="small" style="margin-top: 0.8rem">
            Urban Threads blends street culture with premium materials. Explore
            the collection for limited pieces.
          </p>
        </aside>
      </section>

      <!-- controls -->
      <div class="controls">
        <div class="chips" style="margin-left: 1.25rem">
          <span class="small" style="margin-right: 0.6rem; color: #d7eef0"
            >Filter:</span
          >
          <button class="chip" data-sort="new">Newest</button>
          <button class="chip" data-sort="price-asc">Price ↑</button>
          <button class="chip" data-sort="price-desc">Price ↓</button>
        </div>
      </div>

      <!-- product grid -->
      <section id="products" class="grid" aria-live="polite">
        <!-- JS injects product cards here -->
      </section>
    </main>

    <!-- quick view modal -->
    <div
      class="modal"
      id="productModal"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="modal-card" role="document">
        <div class="modal-left">
          <img id="modalImg" src="" alt="" />
        </div>
        <div class="modal-right">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div>
              <div class="small">New drop</div>
              <h2 id="modalTitle" style="margin: 6px 0 0 0"></h2>
              <div class="small" id="modalSku"></div>
            </div>
            <button
              id="closeModal"
              class="btn-small"
              style="background: transparent; font-size: 1.4rem"
            >
              ✕
            </button>
          </div>

          <div id="modalDesc" class="small" style="margin-top: 8px"></div>

          <div style="margin-top: 12px">
            <div class="small">Size</div>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem">
              <button class="chip size">S</button>
              <button class="chip size">M</button>
              <button class="chip size">L</button>
              <button class="chip size">XL</button>
            </div>
          </div>

          <div style="margin-top: 12px">
            <div
              class="price"
              id="modalPrice"
              style="font-size: 1.25rem; font-weight: 900"
            ></div>
          </div>

          <div style="margin-top: auto; display: flex; gap: 0.6rem">
            <button id="addCartModal" class="btn-add btn-small">
              Add to cart
            </button>
            <button id="viewFull" class="btn-view btn-small">
              Open product
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- cart drawer -->
    <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
      <div class="cart-head">
        Your Cart
        <button
          id="closeCart"
          style="
            background: transparent;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
          "
        >
          ✕
        </button>
      </div>

      <div class="cart-items" id="cartItems"></div>

      <div class="cart-foot">
        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div class="small">Subtotal</div>
          <div id="subTotal" style="font-weight: 800">$0</div>
        </div>
        <button
          class="btn-primary"
          id="checkoutBtn"
          style="width: 100%; border: none; border-radius: 10px"
        >
          Checkout
        </button>
      </div>
    </aside>

    <!-- footer -->
    <footer class="site-footer">
      <div class="container">
        <div style="font-weight: 800">Urban Threads</div>
        <p class="small" style="margin-top: 0.5rem">
          Street classics — modern fit. Designed with care.
        </p>
        <div class="links" style="margin-top: 0.8rem">
          <a href="#">Privacy</a>
          <a href="#">Terms</a>
          <a href="#">Contact</a>
        </div>
      </div>
    </footer>

    <!-- rest of HTML unchanged ... -->

    <script>
      /* ========= Data & initial rendering ========= */
      const products = [
        {
          id: "p1",
          title: "Modern Hoodie",
          price: 38,
          img: "https://images.unsplash.com/photo-1614214191247-5b2d3a734f1b?q=80&w=764&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
          category: "hoodies",
          sku: "KT-001",
          desc: "Soft cotton, Minimal print, relaxed fit.",
        },
        {
          id: "p2",
          title: "Street Hoodie",
          price: 85,
          img: "https://images.unsplash.com/photo-1685354217981-26c14a211bf8?q=80&w=627&auto=format&fit=crop",
          category: "street",
          sku: "SH-101",
          desc: "Heavyweight fleece hoodie with oversized pocket and soft brushed interior.",
        },
        {
          id: "p3",
          title: "Female leather bag",
          price: 28,
          img: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?q=80&w=735&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
          category: "bags",
          sku: "KP-010",
          desc: "Designed for both elegance and everyday use.",
        },
        {
          id: "p4",
          title: "Lightweight trousers",
          price: 120,
          img: "https://images.unsplash.com/photo-1473966968600-fa801b869a1a?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
          category: "trousers",
          sku: "OJ-201",
          desc: "A pair of classic trousers crafted from lightweight yet durable fabric, designed for all-day comfort and style.",
        },
        {
          id: "p5",
          title: "Runner Sneakers",
          price: 110,
          img: "https://images.unsplash.com/photo-1512374382149-233c42b6a83b?q=80&w=735&auto=format&fit=crop",
          category: "street",
          sku: "SR-501",
          desc: "Built for speed, comfort, and everyday wear. Designed with a breathable mesh upper for airflow.",
        },
        {
          id: "p6",
          title: "Tote Bag",
          price: 26,
          img: "https://images.unsplash.com/photo-1578237493287-8d4d2b03591a?q=80&w=626&auto=format&fit=crop",
          category: "bags",
          sku: "MT-330",
          desc: "Its minimalist design and open-top structure make it perfect for carrying books, groceries, or daily essentials.",
        },
      ];

      const categoryNames = {
        hoodies: "Hoodies",
        street: "Street",
        trousers: "Trousers",
        bags: "Bags",
        all: "All",
      };

      function formatMoney(n) {
        return "$" + n.toFixed(2);
      }

      /* make sure these DOM refs exist (defensive) */
      const grid = document.getElementById("products");
      const cartCount = document.getElementById("cartCount");
      const cartCountMobile = document.getElementById("cartCountMobile");
      const featImg = document.getElementById("featImg");
      const sideFeatured = document.getElementById("sideFeatured");

      /* cart storage (object keyed by product id) */
      let cart = {};

      /* Render products into the grid and attach handlers */
      function renderProducts(list) {
        if (!grid) return console.warn("No #products container found.");
        grid.innerHTML = "";
        list.forEach((p) => {
          const card = document.createElement("article");
          card.className = "card product-card";
          card.dataset.id = p.id;
          card.innerHTML = `
      <div class="card-visual">
        <div class="badge">${categoryNames[p.category] || p.category}</div>
        <img loading="lazy" alt="${p.title}" src="${p.img}">
      </div>
      <div class="card-body">
        <div class="title">${p.title}</div>
        <div class="meta">${p.desc.slice(0, 80)}${
            p.desc.length > 80 ? "..." : ""
          }</div>
        <div class="price-row">
          <div class="price">${formatMoney(p.price)}</div>
          <div class="action-row">
            <button class="btn-small btn-view" data-id="${
              p.id
            }">Quick view</button>
            <button class="btn-small btn-add" data-id="${p.id}">Add</button>
          </div>
        </div>
      </div>
    `;
          grid.appendChild(card);
        });
        attachCardHandlers(); // attach listeners after DOM created
      }

      function attachCardHandlers() {
        // Remove prior listeners by cloning nodes (safe rebind strategy)
        document.querySelectorAll(".btn-add").forEach((btn) => {
          const newBtn = btn.cloneNode(true);
          btn.parentNode.replaceChild(newBtn, btn);
        });
        document.querySelectorAll(".btn-view").forEach((btn) => {
          const newBtn = btn.cloneNode(true);
          btn.parentNode.replaceChild(newBtn, btn);
        });

        // Now attach fresh listeners
        document
          .querySelectorAll(".btn-add")
          .forEach((b) => b.addEventListener("click", onAddToCart));
        document
          .querySelectorAll(".btn-view")
          .forEach((b) => b.addEventListener("click", onQuickView));
      }

      /* initial render */
      renderProducts(products);

      /* ================= SEARCH ================= */
      const searchInput = document.getElementById("searchInput");
      const mobileSearch = document.getElementById("mobileSearch");
      if (searchInput) searchInput.addEventListener("input", onSearch);
      if (mobileSearch)
        mobileSearch.addEventListener("input", (e) => {
          if (searchInput) searchInput.value = e.target.value;
          onSearch();
        });

      function onSearch() {
        const q = ((searchInput && searchInput.value) || "")
          .trim()
          .toLowerCase();
        if (!q) return renderProducts(products);
        const filtered = products.filter(
          (p) =>
            p.title.toLowerCase().includes(q) ||
            p.desc.toLowerCase().includes(q)
        );
        renderProducts(filtered);
      }

      /* ================= CHIPS (filters & sorts) ================= */
      const allChips = Array.from(document.querySelectorAll(".chip") || []);
      allChips.forEach((ch) => {
        ch.addEventListener("click", (e) => {
          const sort = ch.getAttribute("data-sort");
          const cat = ch.getAttribute("data-cat");
          // unify active state for desktop & mobile chips
          document
            .querySelectorAll(".chip")
            .forEach((x) => x.classList.remove("active"));
          ch.classList.add("active");

          if (cat) {
            if (cat === "all") renderProducts(products);
            else renderProducts(products.filter((p) => p.category === cat));
          } else if (sort) {
            let list = [...products];
            if (sort === "price-asc") list.sort((a, b) => a.price - b.price);
            if (sort === "price-desc") list.sort((a, b) => b.price - a.price);
            if (sort === "new") list = list.reverse();
            renderProducts(list);
          }
        });
      });

      /* ================= QUICK VIEW MODAL ================= */
      const modal = document.getElementById("productModal");
      const modalImg = modal ? document.getElementById("modalImg") : null;
      const modalTitle = modal ? document.getElementById("modalTitle") : null;
      const modalDesc = modal ? document.getElementById("modalDesc") : null;
      const modalPrice = modal ? document.getElementById("modalPrice") : null;
      const modalSku = modal ? document.getElementById("modalSku") : null;
      const closeModalBtn = modal
        ? document.getElementById("closeModal")
        : null;
      let quickTargetId = null;

      function onQuickView(e) {
        const id = e.currentTarget.getAttribute("data-id");
        const p = products.find((x) => x.id === id);
        if (!p || !modal) return;
        quickTargetId = id;

        // populate modal content
        if (modalImg) modalImg.src = p.img;
        if (modalTitle) modalTitle.textContent = p.title;
        if (modalDesc) modalDesc.textContent = p.desc;
        if (modalPrice) modalPrice.textContent = formatMoney(p.price);
        if (modalSku) modalSku.textContent = "SKU: " + p.sku;

        // show modal
        modal.classList.add("show");
        modal.setAttribute("aria-hidden", "false");

        // attach modal buttons every time (to avoid stale listeners)
        const addBtn = document.getElementById("addCartModal");
        const openBtn = document.getElementById("viewFull");

        if (addBtn) {
          addBtn.onclick = () => {
            addToCart(p.id, 1);
            modal.setAttribute("aria-hidden", "true");
          };
        }

        if (openBtn) {
          openBtn.onclick = () => {
            window.location.href = `/product.html?id=${p.id}`;
            // Change this link to your actual product page setup
          };
        }
      }

      if (closeModalBtn) {
        closeModalBtn.addEventListener("click", () => {
          modal.classList.remove("show");
          modal.setAttribute("aria-hidden", "true");
        });
      }
      if (modal) {
        modal.addEventListener("click", (ev) => {
          if (ev.target === modal) {
            modal.classList.remove("show");
            modal.setAttribute("aria-hidden", "true");
          }
        });
      }

      /* ================= CART DRAWER ================= */
      const cartDrawer = document.getElementById("cartDrawer");
      const cartBtnEl = document.getElementById("cartBtn");
      const mobileCartBtnEl = document.getElementById("mobileCartBtn");
      const closeCartEl = document.getElementById("closeCart");
      const subTotalEl = document.getElementById("subTotal");

      if (cartBtnEl) cartBtnEl.addEventListener("click", openCart);
      if (mobileCartBtnEl)
        mobileCartBtnEl.addEventListener("click", () => {
          openCart();
          closeMobileNav();
        });
      if (closeCartEl)
        closeCartEl.addEventListener("click", () => {
          closeCart();
        });

      function openCart() {
        if (cartDrawer) {
          cartDrawer.classList.add("open");
          cartDrawer.setAttribute("aria-hidden", "false");
        }
      }
      function closeCart() {
        if (cartDrawer) {
          cartDrawer.classList.remove("open");
          cartDrawer.setAttribute("aria-hidden", "true");
        }
      }

      function onAddToCart(e) {
        const id = e.currentTarget.getAttribute("data-id");
        addToCart(id, 1);
      }

      function addToCart(id, qty = 1) {
        if (!id) return;
        if (!cart[id]) {
          const p = products.find((x) => x.id === id);
          if (!p) return;
          cart[id] = { ...p, qty: 0 };
        }
        cart[id].qty += qty;
        updateCartUI();
        openCart();
      }

      function updateCartUI() {
        const cartItemsEl = document.getElementById("cartItems");
        if (!cartItemsEl) return;
        cartItemsEl.innerHTML = "";
        let total = 0,
          count = 0;
        Object.values(cart).forEach((item) => {
          const row = document.createElement("div");
          row.className = "cart-item";
          row.innerHTML = `
      <img src="${item.img}" alt="${item.title}">
      <div style="flex:1">
        <div style="font-weight:700">${item.title}</div>
        <div class="small">${formatMoney(item.price)} × ${item.qty}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <div style="display:flex;gap:6px">
          <button class="cart-dec" data-id="${item.id}">-</button>
          <div>${item.qty}</div>
          <button class="cart-inc" data-id="${item.id}">+</button>
        </div>
        <div style="font-weight:800">${formatMoney(item.price * item.qty)}</div>
      </div>
    `;
          cartItemsEl.appendChild(row);
          total += item.price * item.qty;
          count += item.qty;
        });
        if (subTotalEl) subTotalEl.textContent = formatMoney(total);
        if (cartCount) cartCount.textContent = count;
        if (cartCountMobile) cartCountMobile.textContent = count;

        // attach inc/dec handlers (rebind after rendering)
        document.querySelectorAll(".cart-inc").forEach((b) =>
          b.addEventListener("click", (ev) => {
            const id = ev.currentTarget.getAttribute("data-id");
            if (!cart[id]) return;
            cart[id].qty++;
            updateCartUI();
          })
        );
        document.querySelectorAll(".cart-dec").forEach((b) =>
          b.addEventListener("click", (ev) => {
            const id = ev.currentTarget.getAttribute("data-id");
            if (!cart[id]) return;
            cart[id].qty--;
            if (cart[id].qty <= 0) delete cart[id];
            updateCartUI();
          })
        );
      }

      /* checkout */
      const checkoutBtn = document.getElementById("checkoutBtn");
      if (checkoutBtn)
        checkoutBtn.addEventListener("click", () =>
          alert(
            "Demo checkout — integrate with payment provider for production"
          )
        );

      /* hero CTA */
      const shopNowBtn = document.getElementById("shopNow");
      if (shopNowBtn)
        shopNowBtn.addEventListener("click", () =>
          window.scrollTo({
            top: document.getElementById("products").offsetTop - 20,
            behavior: "smooth",
          })
        );
      const viewCollectionBtn = document.getElementById("viewCollection");
      if (viewCollectionBtn)
        viewCollectionBtn.addEventListener("click", () =>
          alert("Lookbook demo — replace with custom gallery")
        );

      /* featured images */
      if (featImg) featImg.src = products[0].img;
      if (sideFeatured) sideFeatured.src = products[1].img;

      /* ===== mobile nav toggle ===== */
      const hamburger = document.getElementById("hamburger");
      const mobileNav = document.getElementById("mobileNav");
      const mobileClose = document.getElementById("mobileClose");

      function openMobileNav() {
        if (mobileNav) {
          mobileNav.classList.add("open");
          mobileNav.setAttribute("aria-hidden", "false");
        }
      }
      function closeMobileNav() {
        if (mobileNav) {
          mobileNav.classList.remove("open");
          mobileNav.setAttribute("aria-hidden", "true");
        }
      }

      if (hamburger) {
        hamburger.addEventListener("click", () => {
          if (mobileNav && mobileNav.classList.contains("open"))
            closeMobileNav();
          else openMobileNav();
        });
      }
      if (mobileClose) mobileClose.addEventListener("click", closeMobileNav);

      /* mirror chips - when mobile chip clicked, trigger desktop logic */
      const mobileNavChips = Array.from(
        document.querySelectorAll("#mobileNav .chip") || []
      );
      mobileNavChips.forEach((ch) => {
        ch.addEventListener("click", (e) => {
          const cat = ch.getAttribute("data-cat");
          // find desktop chip with same cat
          const desktopChip = Array.from(
            document.querySelectorAll(".chip")
          ).find((x) => x.getAttribute("data-cat") === cat);
          if (desktopChip) desktopChip.click();
          closeMobileNav();
        });
      });

      /* accessibility: close modal with ESC */
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          if (modal) {
            modal.classList.remove("show");
            modal.setAttribute("aria-hidden", "true");
          }
          closeCart();
          closeMobileNav();
        }
      });

      /* initial UI update */
      updateCartUI();

      /* ensure layout recalculations on resize (if needed) */
      window.addEventListener("resize", () => {
        // CSS handles responsive layout; keep here if you add JS resize logic later
      });
    </script>
  </body>
</html>
